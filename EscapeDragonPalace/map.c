#include "init.h"
#include "map.h"


int g_Plus = 24;
char g_Map[49][80] =
{
	"∥==========================================================================∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥==========================================================================∥",
};
char g_BossMap[SCREEN_HEIGHT][SCREEN_WIDTH] =
{
	"∥==========================================================================∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥     =========================================                            ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥     =========================================                            ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥     =========================================                            ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥                                                                          ∥",
	"∥==========================================================================∥",
};

// 용궁 배경
StageBG g_StageBG[STAGE_CNT][BG_CNT] =
{
{ // 맵 - 감옥
	{
		{2, 1},
		E_Gray,
		{
			"______________________________________________",
			"_   __   __   __   __   __   __   __   __   __|",
			" | |  | |  | |  | |  | |  | |  | |  | |  | |",
			" | |  | |  | |  | |  | |  | |  | |  | |  | |",
			" | |__| |__| |  | |  | |  | |__| |__| |  | |",
			" |  _______  |  | |  | |  |  _______  |  | |",
			"_| |       | |__| |__| |__| | | | | | |__| |",
			"_  |       |  __   __   __  | | | | |  __  |",
			" | |       | |  | |  | |  | | | | |.| |  | |",
			" | |       | |  | |  | |  | | | | | | |  | |",
			" | |       | |  | |  | |  | | | | | | |  | |",
		},
	},
	{
		{6, 13},
		E_Gray,
		{
			"                             ________/\\\\/",
			"                            /\\\\_____\\\\/ |",
			"                         _/\\\\/ |  |  |  |",
			"                    ____/\\\\/|  |  |  |  |",
			"                 _/\\\\__\\\\/  |  |  |  |  |",
			"           _____/\\\\/  |  |  |  |  |  |  |",
			"         _/\\\\__\\\\/ |  |  |  |  |  |  |  |",
			"   _____/\\\\/ |  |  |  |  |  |  |  |  |  |",
			" _/\\\\__\\\\/|  |  |  |  |  |  |  |  |  |  |",
			"/\\\\/|  |  |  |  |  |  |  |  |  |  |  |  |",
		},
	},
	{
		{23, 23},
		E_Gray,
		{
			"_____________________________________________________",
			"|                                                    ",
			"|                 _________          _________       ",
			"|        ____    |  _____  |        |  _____  |    __",
			"|       |____|   | | | | | |        | | | | | |   |__",
			"|                | | | | | |        | | | | | |      ",
			"|                | |_|_|_| |        | |_|_|_| |      ",
			"|                |         |        |         |      ",
			"|                |       . |        | .       |      ",
			"|                |  _____  |        |  _____  |      ",
			"|                | | | | | |        | | | | | |      ",
		},
	},
	{
		{2, 37},
		E_Gray,
		{
			"____________________________________________________________________________",
			"_   __   __   __   __   __   __   __   __   __   __   __   __   __   __   __",
			" | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  ",
			" | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  | |  ",
			" | |  | |  | |__| |__| |  | |  | |  | |  | |  | |__| |__| |  | |  | |  | |  ",
			" | |  | |  |  _______  |  | |  | |  | |  | |  |  _______  |  | |  | |  | |  ",
			"_| |__| |__| | | | | | |__| |__| |__| |__| |__| | | | | | |__| |__| |__| |__",
			"_   __   __  | | | | |  __   __   __   __   __  | | | | |  __   __   __   __",
			" | |  | |  | | | | |.| |  | |  | |  | |  | |  | | | | |.| |  | |  | |  | |  ",
			" | |  | |  | | | | | | |  | |  | |  | |  | |  | | | | | | |  | |  | |  | |  ",
			" | |  | |  | | | | | | |  | |  | |  | |  | |  | | | | | | |  | |  | |  | |  ",
		},
	},
	{
		// Goal
		{6, 7},
		E_BrightBlue,
		{
			"  @@@",
			" @@ @@",
			"@@ @ @@",
			" @@ @@",
			"  @@@",
		}
	},
},
{ // 맵 - 용궁
	{
		{36, 4},
		E_Gray,
		{
			"                 /\\        /\\",
			"                ( (________) )",
			"               /             \\",
			"       _______/               \\_______",
			"       \\                             /",
			"        \\___________________________/",
			"             |       ___       |",
			"   __________|______|_|_|______|________",
			"   \\                                   /",
			"    \\_________________________________/",
			"         |        _________        |",
			"         |       |    |    |       |",
			"   ______|_______|____|____|_______|____",
			"  /",
			" /",
			"/_______________________________________",
			"     |           ___________          |",
			"     |          |     |     |         |",
			"     |          |    .|.    |         |",
			"     |          |     |     |         |",
		},
	},
	{
		{3, 29},
		E_Gray,
		{
			"         __ ",
			"       / / /",
			"       \\ \\ \\    __ ",
			"       / / /  / / /",
			"  __   \\ \\ \\  \\ \\ \\",
			"/ / /  / / /  / / /",
			"\\ \\ \\  \\ \\ \\  \\ \\ \\",
		}
	},
	{
		{45, 42},
		E_Gray,
		{
			"        __",
			"       \\ \\ \\",
			" __    / / /",
			"\\ \\ \\  \\ \\ \\",
			"/ / /  / / /",
			"\\ \\ \\  \\ \\ \\",
		}
	},
	{
		{3, 38},
		E_Gray,
		{
			"_____________________ ",
			"                     \\ ",
			"                      \\ ",
			"                       \\ ",
			"________________________\\ ",
			"                  |",
			"_________         |",
			"   |     \\        |",
			"  .|.    |        |",
			"   |     |        |",
		}
	},
	{
		// Goal
		{5, 7},
		E_BrightBlue,
		{
			"  @@@",
			" @@ @@",
			"@@ @ @@",
			" @@ @@",
			"  @@@",
		}
	},
},
};

// 맵 발판
StageBG g_StagePlatform[STAGE_CNT][PLATFORM_CNT] =
{
{ // 감옥 맵 발판
	{
		{42, 43},
		E_BrightWhite,
		{
			"=======",
		}
	},
	{
		{10, 38},
		E_BrightWhite,
		{
			"============================",
		}
	},
	{
		{20, 34},
		E_BrightWhite,
		{
			"========================================================",
		}
	},
	{
		{52, 29},
		E_BrightWhite,
		{
			"======",
		}
	},
	{
		{2, 23},
		E_BrightWhite,
		{
			"==============================================",
		}
	},
	{
		{60, 17},
		E_BrightWhite,
		{
			"==================",
		}
	},
	{
		{2, 12},
		E_BrightWhite,
		{
			"==================================================",
		}
	},
},
{ // 용궁 맵 발판
	{
		{2, 12},
		E_BrightWhite,
		{
			"=====================",
		}
	},
	{
		{26, 18},
		E_BrightWhite,
		{
			"=======",
		}
	},
	{
		{35, 24},
		E_BrightWhite,
		{
			"=========================================",
		}
	},
	{
		{17, 30},
		E_BrightWhite,
		{
			"========",
		}
	},
	{
		{2, 36},
		E_BrightWhite,
		{
			"=====================================================",
		}
	},
	{
		{60, 42},
		E_BrightWhite,
		{
			"================",
		}
	},

},
};

MapStatus g_MapStatus = E_DragonPalace;

// 일반 맵 그리기
void DrawNormalMap()
{
	for (int y = 0; y < SCREEN_HEIGHT; y++)
	{
		const char* mapStr = g_Map[y + g_Plus];
		for (int x = 0; x < SCREEN_WIDTH; x++)
		{
			if (mapStr[x] != ' ')
			{
				_DrawText(x, y, (char[2]) { mapStr[x], });
			}
		}
	}
}

// 일반 맵 배경 그리기
void DrawNormalBG()
{
	// 배경 그리기
	for (int y = 0; y < BG_CNT; y++)
	{
		StageBG* tmpBG = g_StageBG[g_MapStatus]; // 현재 맵의 배경 정보 가져오기
		// 배경 그리기
		for (int x = 0; x < SCREEN_HEIGHT; x++)
		{
			int tmpY = tmpBG[y].pos.y + x - g_Plus;
			if (tmpY < 0 || tmpY > SCREEN_HEIGHT) // 배경이 맵을 벗어났을 때 출력 X
				continue;
			_DrawTextColor(tmpBG[y].pos.x, tmpY, tmpBG[y].bg[x], tmpBG[y].color);
		}
	}
	// 발판 그리기
	for (int i = 0; i < PLATFORM_CNT; i++)
	{
		StageBG* tmpPlatform = g_StagePlatform[g_MapStatus]; // 현재 맵의 발판 정보 가져오기
		// 발판 그리기
		for (int j = 0; j < MAP_HEIGHT; j++)
		{
			int tmpY = tmpPlatform[i].pos.y + j - g_Plus;
			if (tmpY < 0 || tmpY > SCREEN_HEIGHT)
				continue;
			_DrawTextColor(tmpPlatform[i].pos.x, tmpY, tmpPlatform[i].bg[j], tmpPlatform[i].color);
		}
	}
}

// 보스 맵 그리기
void DrawBossMap()
{
	for (int y = 0; y < SCREEN_HEIGHT; y++)
	{
		const char* mapStr = g_BossMap[y];
		for (int x = 0; x < SCREEN_WIDTH; x++)
		{
			if (mapStr[x] != ' ')
			{
				_DrawText(x, y, (char[2]) { mapStr[x], });
			}
		}
	}
}

// 맵 위치 업데이트
void UpdateMapPos()
{
	if (g_Key == 'w' || g_Key == 'W')
	{
		--g_Plus;
	}
	else if (g_Key == 's' || g_Key == 'S')
	{
		++g_Plus;
	}
	if (g_Plus < 0)
		g_Plus = 0;
	else if (g_Plus > 24)
		g_Plus = 24;
}

int GetMapStatus()
{
	return g_MapStatus;
}